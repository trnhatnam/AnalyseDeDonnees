---
title: "NBA_hof_supervised"
output: html_document
date: "2024-05-03"
---

# 0. Prétraitement des données

```{r}
nba_hof_data = read.csv2("data_hof_award.csv", sep=",", dec=".", header=TRUE)
head(nba_hof_data)
str(nba_hof_data)
dim(nba_hof_data)
```
Par rapport à l'étude précédent pour les données de saison rookie rajoutées pour le clustering non supervisé, nous savons que la database possède des valeurs 'Nan' pour les colonnes '..._rookie_season'. On verifie également que d'autres colonnes ne possèdent pas de valeurs 'Nan' pour déterminer si on les supprime ou non. Les colonnes liées à l'année nba sont également présentent en plusieurs exemplaires ('season_x','season_year','year','season').

```{r}
# Compter les valeurs NaN pour chaque colonne dans la base de données data_hof_nba
nombre_nan_par_colonne <- colSums(is.na(nba_hof_data))

# Afficher le nombre de valeurs NaN pour chaque colonne
print(nombre_nan_par_colonne)
```


On va supprimer des données pas très pertinentes et que tous les joueurs ne possèdent pas vraiment comme les données des saisons rookie de tous les joueurs même si elles auraient pu donner une idée de si un rookie/joueur récent à la possibilité d'intégré le hall of fame.

```{r}
# Supprimer les colonnes de la base de données data_hof_nba
nba_hof_data <- subset(nba_hof_data, select = -c(pts_rookie_season, reb_rookie_season, ast_rookie_season,usg_pct_rookie_season, ts_pct_rookie_season, season_x,year,season,age))

head(nba_hof_data)
```
Pour continuer, on va convertir les valeurs booléennes en entier ('True' == 1, 'False' == 0) pour la mise en place du clustering supervisé pour utiliser ces colonnes.

```{r}
# Identifier les colonnes avec des valeurs 'True' ou 'False'
colonnes_a_modifier <- sapply(nba_hof_data, function(col) any(col %in% c('True', 'False')))

# Remplacer 'True' par 1 et 'False' par 0 dans ces colonnes
nba_hof_data[, colonnes_a_modifier] <- lapply(nba_hof_data[, colonnes_a_modifier], function(col) {
  col <- ifelse(col == 'True', 1, ifelse(col == 'False', 0, col))
})

# Convertir les colonnes modifiées en type integer
nba_hof_data[, colonnes_a_modifier] <- lapply(nba_hof_data[, colonnes_a_modifier], as.integer)


head(nba_hof_data)
```
Le but de notre classification supervisée sera de pouvoir déterminer si un joueur est éligible ou non à l'accès au Hall of Fame (soit le Panthéon des joueurs NBA). Pour cela, nous étudierons les données des joueurs durant leur carrière respective. Il faut donc regrouper les données de chaque saison de manière logique pour chaque joueur. On aura à la fin, une ligne pour chaque joueur.

Avant ceci, pour justement pouvoir effectuer de manière logique pour la suite ce clustering supervisé, il faudra séparer les joueurs actuels que les joueurs ayant pris leur retraite/ou parti de la NBA. Ainsi on conservera des données de test pour voir si certains joueurs actuels on des possibilités plus ou moins faibles d'intégrer le Hall of Fame.

Ici, pour essayer de ne pas mal influencer, nous verifions les données de hall_of_fame de 5 joueurs récemment entrés au Hall of Fame en 2023 (pour les 4 des 5 testés, l'autre est récent aussi). Si la valeur 0 est présente au sein de la colonne hall_of_fame, il faut mettre ces 5 joueurs dans les données à tester. 
```{r}
# Supposons que votre base de données contient une colonne 'Nom' avec les noms des joueurs
tony_parker <- subset(nba_hof_data, player_name == "Tony Parker")
dwyane_wade <- subset(nba_hof_data, player_name == "Dwyane Wade")
dirk_nowitzki <- subset(nba_hof_data, player_name == "Dirk Nowitzki")
kobe_bryant <- subset(nba_hof_data, player_name == "Kobe Bryant")
pau_gasol <- subset(nba_hof_data, player_name == "Pau Gasol")
manu_ginobili <- subset(nba_hof_data, player_name == "Manu Ginobili")

# Afficher les informations sur Tony Parker
print(tony_parker)

# Afficher les informations sur Dwyane Wade
print(dwyane_wade)

# Afficher les informations sur Dirk Nowitzki
print(dirk_nowitzki)

# Afficher les informations sur Kobe Bryant
print(kobe_bryant)

# Afficher les informations sur Pau Gasol
print(pau_gasol)
```
Comme on peut le voir ici, les 4 joueurs ayant été inaugurés au Hall of Fame 2023 possèdent la valeur 0 pour la colonne associée. Donc il sera judicieux de les mettre dans la database à tester pour ne pas influencer de mauvaise manière le clustering.

Séparons notre database principale en 2 databases avec les anciens joueurs et les joueurs actuels/récemment retirés.

```{r}
# Identifier les joueurs dont l'année maximale est inférieure à 2018
joueurs_inferieurs_2018 <- subset(nba_hof_data, ave(season_year, player_name, FUN = max) < 2018)

# Identifier tous les joueurs
tous_les_joueurs <- unique(nba_hof_data$player_name)

# Identifier les joueurs parmi tous les joueurs qui ont des années supérieures ou égales à 2018
joueurs_superieurs_2018 <- subset(nba_hof_data, ave(season_year, player_name, FUN = max) >= 2018)

# Créer la base de données des joueurs dont l'année max est inférieure à 2018
data_old_player <- subset(nba_hof_data, player_name %in% joueurs_inferieurs_2018$player_name)

# Créer la base de données des joueurs dont l'année max est supérieure ou égale à 2018
data_recent_player <- subset(nba_hof_data, player_name %in% joueurs_superieurs_2018$player_name)

```

Vérifions vite fait

```{r}
head(data_old_player)
head(data_recent_player)

dim(data_old_player)
dim(data_recent_player)
```
Vérifions la présence des 5 joueurs au sein des bonnes databases.

```{r}
# Joueurs à vérifier
joueurs_a_verifier <- c("Tony Parker", "Dwyane Wade", "Dirk Nowitzki", "Pau Gasol", "Kobe Bryant")

# Vérification dans la base de données des joueurs dont l'année max est inférieure à 2018
verif_inferieure_2018 <- subset(data_old_player, player_name %in% joueurs_a_verifier)

# Vérification dans la base de données des joueurs dont l'année max est supérieure ou égale à 2018
verif_superieure_2018 <- subset(data_recent_player, player_name %in% joueurs_a_verifier)

# Affichage des résultats
print("Vérification dans la base de données des joueurs dont l'année max est inférieure à 2018 :")
print(verif_inferieure_2018)

print("Vérification dans la base de données des joueurs dont l'année max est supérieure ou égale à 2018 :")
print(verif_superieure_2018)

```
Comme vérifier antérieurement les joueurs récemment inaugurés au Hall of Fame sont dans la database à tester. Contrairement à l'autre qui est dans celle à utiliser comme souhaité.

Pour la classification supervisé on convertit les colonne str de manière judicieuse, (1 pour les joueurs ayant été champions nba l'année indiqué, pareil pour finalist et mvp_finals)

```{r}
# Pour data_old_player
data_old_player$nba_champion <- ifelse(data_old_player$team_abbreviation == data_old_player$nba_champion, 1, 0)
data_old_player$finalist <- ifelse(data_old_player$team_abbreviation == data_old_player$finalist, 1, 0)
data_old_player$mvp_finals <- ifelse(data_old_player$player_name == data_old_player$mvp_finals, 1, 0)

# Pour data_recent_player
data_recent_player$nba_champion <- ifelse(data_recent_player$team_abbreviation == data_recent_player$nba_champion, 1, 0)
data_recent_player$finalist <- ifelse(data_recent_player$team_abbreviation == data_recent_player$finalist, 1, 0)
data_recent_player$mvp_finals <- ifelse(data_recent_player$player_name == data_recent_player$mvp_finals, 1, 0)
```

On convertit en facteur les colonnes college et country pour pas de problème lors de la fusion selon les joueurs

```{r}
# Convertir les colonnes contenant les noms de pays et de collèges en facteurs s'ils sont identiques pour chaque joueur
data_old_player$college <- as.factor(data_old_player$college)
data_old_player$country <- as.factor(data_old_player$country)

data_recent_player$college <- as.factor(data_recent_player$college)
data_recent_player$country <- as.factor(data_recent_player$country)

```

On génère des databases selon le nom des joueurs avec les colonnes suivantes de summarise.

```{r}
# Chargement de la bibliothèque dplyr
library(dplyr)

# Regroupement des lignes par joueur et calcul de la moyenne pour certaines colonnes, addition pour d'autres
data_old_player_career <- data_old_player %>%
  group_by(player_name) %>%
  summarise(
    player_height = mean(player_height),
    player_weight = mean(player_weight),
    college = college,
    country = country,
    draft_year = draft_year,
    draft_round = draft_round,
    draft_number = draft_number,
    gp_career = sum(gp),
    gp_by_season = mean(gp),
    pts_career_avg = mean(pts),
    reb_career_avg = mean(reb),
    ast_career_avg = mean(ast),
    net_rating_career = mean(net_rating),
    oreb_pct_career = mean(oreb_pct),
    dreb_pct_career = mean(dreb_pct),
    usg_pct_career = mean(usg_pct),
    ts_pct_career = mean(ts_pct),
    ast_pct_career = mean(ast_pct),
    num_seasons = mean(num_seasons),
    hall_of_fame = mean(hall_of_fame),
    indiv_awards = sum(indiv_award),
    playoffs_career = sum(playoffs),
    nba_titles = sum(nba_champion),
    mvp_finals = sum(mvp_finals),
    finalist_career = sum(finalist)
  )

data_recent_player_career <- data_recent_player %>%
  group_by(player_name) %>%
  summarise(
    player_height = mean(player_height),
    player_weight = mean(player_weight),
    college = college,
    country = country,
    draft_year = draft_year,
    draft_round = draft_round,
    draft_number = draft_number,
    gp_career = sum(gp),
    gp_by_season = mean(gp),
    pts_career_avg = mean(pts),
    reb_career_avg = mean(reb),
    ast_career_avg = mean(ast),
    net_rating_career = mean(net_rating),
    oreb_pct_career = mean(oreb_pct),
    dreb_pct_career = mean(dreb_pct),
    usg_pct_career = mean(usg_pct),
    ts_pct_career = mean(ts_pct),
    ast_pct_career = mean(ast_pct),
    num_seasons = mean(num_seasons),
    hall_of_fame = mean(hall_of_fame),
    indiv_awards = sum(indiv_award),
    playoffs_career = sum(playoffs),
    nba_titles = sum(nba_champion),
    mvp_finals = sum(mvp_finals),
    finalist_career = sum(finalist)
  )

head(data_old_player_career)
head(data_recent_player_career)
```
On peut constater la présence de duplicates, on va donc en conserver qu'une ligne pour chaque joueur ce qui est normal.

```{r}
# Supprimer les doublons de data_old_player_career
data_old_player_career <- distinct(data_old_player_career)

# Supprimer les doublons de data_recent_player_career
data_recent_player_career <- distinct(data_recent_player_career)

head(data_old_player_career)
head(data_recent_player_career)

dim(data_old_player_career)
dim(data_recent_player_career)
```
A noté que le facteur le plus perturbant de la mise en place de nos clustering non-supervisée et supervisé est tout simplement liée au fait que les données commence en 1996 et que les joueurs ayant été en NBA avant, n'ont tout simplement pas toutes leurs stats de toutes leurs saisons effectuées.

A part ce problème principale ne pouvant être régler que par l'ajout de ces valeurs antérieurs ce qui rendrait les bases de données complètes et sans biais possible.

Le traitement des données à l'air d'être réalisé correctement et on va pouvoir réalisé notre clustering supervisé pour le Hall of Fame.
